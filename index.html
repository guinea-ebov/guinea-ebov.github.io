<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Daily report (data, maps and graphs) of the Ebola outbreak in Guinea, Rapport journalier (données, cartes, graphes) de l'épidémie Ebola en Guinée, 2014, 2015, VHF">
    <meta name="author" content="WHO, OMS">
    <title>Guinea - EBOV</title>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61269519-1', 'auto');
      ga('send', 'pageview');

    </script>
    <!-- Bootstrap core CSS -->
    <link href="code/src/bootstrap-3.3.4-dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="code/src/leaflet/leaflet.css"/>
    <link rel="stylesheet" href="code/css/leaflet.label.css" />

    <link rel="stylesheet" href="code/css/style.css"/>
    <script src="code/src/jquery-2.1.1.min.js"></script>
    
    <script src="code/src/html5slider.js"></script>
    <script>L_PREFER_CANVAS = true;</script>
    <script src="code/src/leaflet/leaflet.js"></script>
    <script src='code/src/leaflet-image.js'></script>
    <script src="code/src/leaflet/leaflet.label.js"></script>
    <script src='code/src/jput-2.js'>></script>
    <script src='code/src/stupidtable.min.js'>></script>
    <script src='code/src/table2CSV.js'>></script>
    <script src='code/data/layers/sous_pref.geojson'></script>
    <script src='code/data/layers/countries.geojson'></script>
    <script src='code/data/layers/prefectures.geojson'></script>
    <script src='code/data/table_7d.json'></script>
    <script src='code/data/table_21d.json'></script>
    <script src='code/data/table_cumul.json'></script>
    <script src='code/data/table_cumul_2015.json'></script>
    <script src="code/data/data_per_day.geojson" type="text/javascript"></script>
    <script src="code/data/data_per_week.geojson" type="text/javascript"></script>
    <script src="code/data/cumulative_daily.geojson" type="text/javascript"></script>
    <script src="code/data/cumulative_daily_2015.geojson" type="text/javascript"></script>
    <script src="code/data/last_7d_daily.geojson" type="text/javascript"></script>
    <script src="code/data/last_21d_daily.geojson" type="text/javascript"></script>


     
    <script type="text/javascript">
    $(function(){
        $("table").stupidtable();
        $('div.panel').hide();
    });
    </script>

  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html"><img src="code/img/cellule_nationale.png" width="53px" height="51px">&nbsp;Guinea - EBOV</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <!-- <li class="active"><a href="#">Home</a></li> -->
            <li><a href="niveau_alerte.html">Niveau d'alerte</a></li>
            <li><a href="reticences.html">Réticences</a></li>
            <li><a href="centres.html">Centres</a></li>
            <li><a href="epi_weeks.html">Epi weeks</a></li>
            <li><a href="stats.html">Stats</a></li>
            <!-- <li><a href="personnel.html">Personnel</a></li> -->
            <li><a href="liens_utiles.html">Liens utiles</a></li>
            <li><a href="sitreps.html">Sitreps</a></li>
            <li><a id="nouv" href="nouveautes.html">Nouveautés</a></li>
            <li><img src="code/img/who_logo.svg" width="150px" height="50px"></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    <div class="epi_content">
        
    <a href="code/files/map/cas_villages_2015_8_27.pdf"><span class="glyphicon glyphicon-picture" aria-hidden="true"></span>&nbsp;Carte des cas confirmés par villages durant les 21 derniers jours à la date du 27/8/2015</a>
     <h2>Localisation des cas confirmés par sous-préfectures&nbsp;<a href="#" id="miseAjour" class="btn btn-info" rel="popover" data-html="true"><span class="glyphicon glyphicon-time" aria-hidden="true"></span></a></h2>
     <div class='dlmap'>
     <a id="print" href=""></a> | <a href="code/img/legende_cas_confirmes.png" download>Télécharger la légende</a></div>
     <div  id="wheel" >
     <img src="code/img/spinning-wheel.gif"/ width="20px" height="20px">
     Impression en cours...</div>
      <div id="map"></div>
      <br />
      <div class="alert alert-info" role="alert">
      La date considérée ici est la date de notification.
      </div>
      <br />
      <div class="panel panel-default">
      <div class="panel-heading"><a href="#" onClick ="doExport({type:"json"});"></a></div>
      <table class="table table-striped">
         <thead>
            <tr>
                <th data-sort="string">Préfecture</th>
                <th data-sort="string">Sous-préfecture</th>
                <th data-sort="int"># Cas</th>
            </tr> 
         </thead>
         <tbody jput="users" jput-jsondata='[]'>
            <tr>
                
               <td>{{json.pref}}</td>
               <td>{{json.sous_pref}}</td>
               <td>{{json.nb_cas}}</td>
               
            </tr>
      </tbody>
      </table>
      </div>

    <script>
 $(document).ready(function() {

        var cases;
        var semaine_map;
        var jour_map;
        var scaleFactor = 11;
        var multiplicateur = 1.7;
         var map = L.map('map', { 
                center: [10, -11.3441], 
                zoom: 7,    
                minZoom: 6  
            });

         function doImage(err, canvas) {
                var img = document.createElement('img');
                var dimensions = map.getSize();
                img.width = dimensions.x;
                img.height = dimensions.y;
                img.src = canvas.toDataURL("image/png");

                var suffixe_file = $("select").val()[0];
                var suffix;
                auj = new Date();
                auj.setDate(auj.getDate() - 1);
                auj = auj.getFullYear() + '_' + parseInt(auj.getMonth() + 1) + '_' + auj.getDate(); 
                if (suffixe_file === "1") {
                    suffix = jour_map;
                }
                else if (suffixe_file === "2") {
                    suffix = 'semaine_' + semaine_map;
                }
                else if (suffixe_file === "3") {
                    suffix = '7_derniers_jours_' + auj;
                }
                else if (suffixe_file === "4") {
                    suffix = '21_derniers_jours_' + auj;
                }
                else if (suffixe_file === "5") {
                    suffix = 'cumul_2015_' + auj;
                }
                else{
                    suffix = 'cumul_' + auj;
                };
                
                $("a#print").attr("download", 'cas_confirmes_' + suffix + '.png')
                $("a#print").attr("href", img.src)

                $('#wheel').hide();
                $("a#print").html("Télécharger la carte");
                $('.dlmap').fadeIn("slow");
            }

         var OpenStreetMap_HOT = L.tileLayer('http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Tiles courtesy of <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a>'
});

        var sous_pref = L.geoJson(sp, {
            style: function (feature) {
                return {fillColor: "#ffffbf",
                        color: "#d8b365",
                        weight: 0.8,
                        opacity: 0.8,
                        fillOpacity: .7};
            },
            onEachFeature: function (feature, layer) {
                layer.bindPopup(feature.properties.name, {autoPan: false});
            }
        });

        var countries = L.geoJson(countr, {
            style: function (feature) {
                return {fillColor: "white",
                        color: "black",
                        weight: 1,
                        opacity: 0.8,
                        fillOpacity: 0.8};
            }
        });

        var prefs = L.geoJson(prfs, {
            style: function (feature) {
                return {color: "#8A4117",
                        weight: 1,
                        opacity: 0.8};
            }
        });


        var baseLayers = L.layerGroup([countries, sous_pref, prefs]).addTo(map);
        
        var labelmal= new L.Label();
        labelmal.setContent("<em>MALI</em>");
        labelmal.setLatLng([11.5,-7.55]);
        map.showLabel(labelmal);
        
        var labelciv = new L.Label();
        labelciv.setContent("<em>CÔTE D'IVOIRE</em>");
        labelciv.setLatLng([9.5,-7.55]);
        map.showLabel(labelciv);

        var labelsle = new L.Label();
        labelsle.setContent('<em> SIERRA</br>LEONE</em>');
        labelsle.setLatLng([8.6,-12.2]);
        map.showLabel(labelsle);

        var labellib = new L.Label();
        labellib.setContent('<em>LIBERIA</em>');
        labellib.setLatLng([ 6.8,  -10.5]);
        map.showLabel(labellib);

        var labelgb = new L.Label();
        labelgb.setContent('<em>GUINEE</br>BISSAU</em>');
        labelgb.setLatLng([12.2, -15.2]);
        map.showLabel(labelgb);

        var labelsen = new L.Label();
        labelsen.setContent('<em>SENEGAL</em>');
        labelsen.setLatLng([14.5, -15]);
        map.showLabel(labelsen);


        var cumulative = L.geoJson(data_cumulative, {  
            onEachFeature: function (feature, layer) {
                popupContent = "<b>" + feature.properties.name + " </b><br>" +
                               "<b>" + String(feature.properties.total) +
                               "</b> cas";
                // Calculations for radius in function of field 'total'
                area = feature.properties.total * scaleFactor;
                radius =  Math.sqrt(area/Math.PI) * multiplicateur
                layer.setRadius(radius);
                layer.bindPopup(popupContent, { offset: new L.Point(0,-radius) }); 
                layer.on({
                    mouseover: function(e) {
                        this.openPopup();
                        this.setStyle({color: 'yellow', weight: 2});
                    },
                    mouseout: function(e) {
                        this.closePopup();
                        this.setStyle({color: '#537898', weight: 1});     
                    }
                });
            },
            pointToLayer: function(feature, latlng) {   
                // Calculations for radius. Same as bellow
                area = feature.properties.total * scaleFactor;
                return L.circleMarker(latlng, {     
                    radius: Math.sqrt(area/Math.PI) * multiplicateur,
                    /*fillColor: feature.properties.color, */
                    fillColor: "red", 
                    color: '#537898',   
                    weight: 1,  
                    fillOpacity: 0.6  
                });
            }
        });

        var cumulative_2015 = L.geoJson(data_cumulative_2015, {  
            onEachFeature: function (feature, layer) {
                popupContent = "<b>" + feature.properties.name + " </b><br>" +
                               "<b>" + String(feature.properties.total) +
                               "</b> cas";
                // Calculations for radius in function of field 'total'
                area = feature.properties.total * scaleFactor;
                radius =  Math.sqrt(area/Math.PI) * multiplicateur
                layer.setRadius(radius);
                layer.bindPopup(popupContent, { offset: new L.Point(0,-radius) }); 
                layer.on({
                    mouseover: function(e) {
                        this.openPopup();
                        this.setStyle({color: 'yellow', weight: 2});
                    },
                    mouseout: function(e) {
                        this.closePopup();
                        this.setStyle({color: '#537898', weight: 1});     
                    }
                });
            },
            pointToLayer: function(feature, latlng) {   
                // Calculations for radius. Same as bellow
                area = feature.properties.total * scaleFactor;
                return L.circleMarker(latlng, {     
                    radius: Math.sqrt(area/Math.PI) * multiplicateur,
                    /*fillColor: feature.properties.color, */
                    fillColor: "red", 
                    color: '#537898',   
                    weight: 1,  
                    fillOpacity: 0.6  
                });
            }
        });
        
        var last_7d = L.geoJson(data_7d, {  
            onEachFeature: function (feature, layer) {
                popupContent = "<b>" + feature.properties.name + " </b><br>" +
                               "<b>" + String(feature.properties.total) +
                               "</b> cas";
                // Calculations for radius in function of field 'total'
                area = feature.properties.total * scaleFactor;
                radius =  Math.sqrt(area/Math.PI) * multiplicateur
                layer.setRadius(radius);
                layer.bindPopup(popupContent, { offset: new L.Point(0,-radius) }); 
                layer.on({
                    mouseover: function(e) {
                        this.openPopup();
                        this.setStyle({color: 'yellow', weight: 2});
                    },
                    mouseout: function(e) {
                        this.closePopup();
                        this.setStyle({color: '#537898', weight: 1});     
                    }
                });
            },
            pointToLayer: function(feature, latlng) {   
                // Calculations for radius. Same as bellow
                area = feature.properties.total * scaleFactor;
                return L.circleMarker(latlng, {     
                    radius: Math.sqrt(area/Math.PI) * multiplicateur,
                    /*fillColor: feature.properties.color, */
                    fillColor: "red", 
                    color: '#537898',   
                    weight: 1,  
                    fillOpacity: 0.6  
                });
            }
        });

        var last_21d = L.geoJson(data_21d, {  
            onEachFeature: function (feature, layer) {
                popupContent = "<b>" + feature.properties.name + " </b><br>" +
                               "<b>" + String(feature.properties.total) +
                               "</b> cas";
                // Calculations for radius in function of field 'total'
                area = feature.properties.total * scaleFactor;
                radius =  Math.sqrt(area/Math.PI) * multiplicateur
                layer.setRadius(radius);
                layer.bindPopup(popupContent, { offset: new L.Point(0,-radius) }); 
                layer.on({
                    mouseover: function(e) {
                        this.openPopup();
                        this.setStyle({color: 'yellow', weight: 2});
                    },
                    mouseout: function(e) {
                        this.closePopup();
                        this.setStyle({color: '#537898', weight: 1});     
                    }
                });
            },
            pointToLayer: function(feature, latlng) {   
                // Calculations for radius. Same as bellow
                area = feature.properties.total * scaleFactor;
                return L.circleMarker(latlng, {     
                    radius: Math.sqrt(area/Math.PI) * multiplicateur,
                    /*fillColor: feature.properties.color, */
                    fillColor: "red", 
                    color: '#537898',   
                    weight: 1,  
                    fillOpacity: 0.6  
                });
            }
        });

///////////////////////////////////////////////////////////////////
function processData(data) {
    var timestamps = [],    
        min = Infinity, 
        max = -Infinity;

    for (var feature in data.features) {    

        var properties = data.features[feature].properties; 

        for (var attribute in properties) { 

            if ( attribute != 'id' &&   
                 attribute != 'name' &&   
                 attribute != 'color') 
            {
                if ( $.inArray(attribute,timestamps) ===  -1) { 
                    timestamps.push(attribute);
                }

                if (properties[attribute] < min) {  
                    min = properties[attribute]; 
                }
                if (properties[attribute] > max) { 
                    max = properties[attribute];          
                }
            }
        }
    }
    return {    
        timestamps : timestamps,
        min : min,
        max : max
    }
}  // end processData()

function createPropSymbols(timestamps, data, step) {
    // step parameter is only used in the updatePropSymbols function
    cases = L.geoJson(data, {      
        pointToLayer: function(feature, latlng) {   
            return L.circleMarker(latlng, {         
                fillColor: 'red', 
                color: '#537898',   
                weight: 1,  
                fillOpacity: 0.6  
            });
        }
    }).addTo(map);
    
    updatePropSymbols(timestamps[timestamps.length-1], step);   

} // end createPropSymbols()

function updatePropSymbols(timestamp, step) {
    cases.eachLayer(function(layer) {  
        
    var props = layer.feature.properties,
        radius = calcPropRadius(props[timestamp]);

    if (step == 'day') {
        d_date = new Date(Math.floor(timestamp));
        /*$(".temporal-legend").text('Week ' + this.value.getDate());*/
        var date_format = d_date.getDate() + '/' +  parseInt(d_date.getMonth() + 1) + '/' +  d_date.getFullYear();

        popupContent = "<b>" + props.name + " </b><br>" +
                       "<b>" + String(props[timestamp]) +
                       "</b> cas le " + date_format;

    }
    // step == 'week'
    else {
        if (timestamp <= 53) {
            popupContent = "<b>" + props.name + " </b><br>" +
                       "<b>" + String(props[timestamp]) +
                       "</b> cas dans la semaine " + timestamp + " de 2014";
        }
        else{
            popupContent = "<b>" + props.name + " </b><br>" +
                       "<b>" + String(props[timestamp]) +
                       "</b> cas dans la semaine " + String(timestamp - 53) + " de 2015";
        };
        
    };               
    layer.setRadius(radius);
    layer.bindPopup(popupContent, { offset: new L.Point(0,-radius) }); 
    layer.on({
        mouseover: function(e) {
            this.openPopup();
            this.setStyle({color: 'yellow', weight: 2});
        },
        mouseout: function(e) {
            this.closePopup();
            this.setStyle({color: '#537898', weight: 1});     
        }
    });  
})
} 

function calcPropRadius(attributeValue) {         
        area = attributeValue * scaleFactor; 
    return Math.sqrt(area/Math.PI) * multiplicateur;       
}
// end calcPropRadius

// A ameliorer !!!
function createLegend(min, max) {
             
    if (min < 10) { 
        min = 1; 
    }
    function roundNumber(inNumber) {

        return (Math.round(inNumber/10) * 10);  
    }

    var legend = L.control( { position: 'bottomright' } );

    legend.onAdd = function(map) {

        var legendContainer = L.DomUtil.create("div", "legend"),  
            symbolsContainer = L.DomUtil.create("div", "symbolsContainer"),
            classes = [1, 50, 100], 

            diameter,
            diameters = [];

        L.DomEvent.addListener(legendContainer, 'mousedown', function(e) { L.DomEvent.stopPropagation(e); });  

        $(legendContainer).append("<h2 id='legendTitle'>Nombre de cas<br/>confirmés</h2>");
        
        for (var i = 0; i < classes.length; i++) {  

            legendCircle = L.DomUtil.create("div", "legendCircle");  
            diameter = calcPropRadius(classes[i]) * multiplicateur; 
            diameters.push(diameter);               
            var lastdiameter;                   
            if (diameters[i-1]){
                lastdiameter = diameters[i-1];
            } else {
                lastdiameter = 0;
            };
            $(legendCircle).attr("style", "width: "+diameter+"px; height: "+diameter+
                "px; margin-left: -"+((diameter+lastdiameter+2)/2)+"px" );                   
            $(legendCircle).append("<span class='legendValue'>"+classes[i]+"<span>");
            $(symbolsContainer).append(legendCircle);   
        };
        $(legendContainer).append(symbolsContainer); 
        return legendContainer; 

    };

    legend.addTo(map);  
}
// end createLegend()

function createSliderUI(timestamps, step) {
    var sliderControl = L.control({ position: 'bottomleft'} );

    sliderControl.onAdd = function(map) {

        var slider = L.DomUtil.create("input", "range-slider");

        L.DomEvent.addListener(slider, 'mousedown', function(e) { 

            L.DomEvent.stopPropagation(e); 

        });
        if( step == 'week') {
            $(slider)
            .attr({'type':'range', 'max': timestamps[timestamps.length-1], 'min':timestamps[0], 'step': 1,'value': timestamps[timestamps.length-1]}).on('input change', function() {

                updatePropSymbols($(this).val().toString(), 'week');
                $('output.temporal-legend').removeAttr('id');
                $(".temporal-legend").text('Semaine ' + this.value);
                if (this.value <= 53) {
                    $(".temporal-legend").text('Semaine ' + this.value + ' de 2014');
                    semaine_map = this.value + '_2014';
                }   
                else{
                    $(".temporal-legend").text('Semaine ' + String(this.value - 53) + ' de 2015');
                    semaine_map = String(this.value - 53) + '_2015';
                };
            });
        }
        // step == 'day'
        else {
            $(slider)
            .attr({'type':'range', 'max': timestamps[timestamps.length-1], 'min':timestamps[0], 'step': 86400000,'value': timestamps[timestamps.length-1]}).on('input change', function() {

                updatePropSymbols($(this).val().toString(), 'day');
                $('output.temporal-legend').removeAttr('id');
                d_date = new Date(Math.floor(this.value));

                $(".temporal-legend").text(d_date.getDate() + '/' +  parseInt(d_date.getMonth() + 1) + '/' +  d_date.getFullYear());

                jour_map = d_date.getFullYear() + '_' + parseInt(d_date.getMonth() + 1) + '_' + d_date.getDate(); 

                if (timestamps.indexOf(this.value) >= timestamps.length-21 && timestamps.indexOf(this.value) < timestamps.length-7) {
                    $("output.temporal-legend").addClass( "last3weeks" );
                    $("output.temporal-legend").removeClass( "lastweek");
                }
                else if (timestamps.indexOf(this.value) >= timestamps.length-7) {
                    $("output.temporal-legend").removeClass( "last3weeks");
                    $("output.temporal-legend").addClass( "lastweek");

                }
                 else { $("output.temporal-legend").removeClass( "last3weeks");};       
            });
        };
        return slider;
    }
    sliderControl.addTo(map);
    createTemporalLegend(timestamps[timestamps.length-1], step);
} // end createSliderUI()

function createTemporalLegend(startTimestamp, step) {
    var temporalLegend = L.control({ position: 'bottomleft' });  

    temporalLegend.onAdd = function(map) {  

        var output = L.DomUtil.create("output", "temporal-legend");

        return output;  
    }

    // When page loads the first time
    // I have to do that beacause at this time step is undefined
    $(document).ready(function() {
        d_date = new Date(Math.floor(startTimestamp));
        $(".temporal-legend").text(d_date.getDate() + '/' +  parseInt(d_date.getMonth() + 1) + '/' +  d_date.getFullYear());
        $("output.temporal-legend").addClass( "lastweek");
        jour_map = d_date.getFullYear() + '_' + parseInt(d_date.getMonth() + 1) + '_' + d_date.getDate(); 
    });

    temporalLegend.addTo(map);  
    if (step == 'day') {
        //d_date = new Date(Math.floor(startTimestamp));
        $(".temporal-legend").text(d_date.getDate() + '/' +  parseInt(d_date.getMonth() + 1) + '/' +  d_date.getFullYear());
        $("output.temporal-legend").addClass( "lastweek");
    }
    else{
        if (startTimestamp <= 53) {
            $(".temporal-legend").text('Semaine ' + startTimestamp + ' de 2014');
            semaine_map = startTimestamp + '_2014';
        }
        else{
        $(".temporal-legend").text('Semaine ' + String(startTimestamp - 53) + ' de 2015'); 
        semaine_map = String(startTimestamp - 53) + '_2015';
        };
    };
}
///////////////////////////////////////////////////////////////////

        
        var dataInfo = processData(data_per_day);   

                createPropSymbols(dataInfo.timestamps, data_per_day, 'day');
                createLegend(dataInfo.min,dataInfo.max);   
                createSliderUI(dataInfo.timestamps); 



var dropdmenu = L.control({position: 'topright'});
dropdmenu.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info dropdmenu');
    div.innerHTML = '<select class="form-control choix_temp"><option value="1">Cas confirmés par jours</option><option value="2">Cas confirmés par semaines</option><option value="3">Cas confirmés - 7 derniers jours</option><option value="4">Cas confirmés - 21 derniers jours</option><option value="5">Cas confirmés - 2015</option><option value="6">Cas confirmés - depuis le début</option></select>';
    div.firstChild.onmousedown = div.firstChild.ondblclick = L.DomEvent.stopPropagation;
    return div;
};

dropdmenu.addTo(map);

$("select").change(
 function () {
  var val=this.value;
    if ($(this).val() == "1") {
        $(".legend").remove();
        $("output.temporal-legend").remove();
        $("input.range-slider").remove();

        map.removeLayer(cases);
        map.removeLayer(cumulative);
        map.removeLayer(last_7d);
        map.removeLayer(last_21d);
        map.removeLayer(cumulative_2015);

        var dataInfo = processData(data_per_day);   
                createPropSymbols(dataInfo.timestamps, data_per_day, 'day');  
                createLegend(dataInfo.min,dataInfo.max);    
                createSliderUI(dataInfo.timestamps, 'day');

        $('div.panel').hide();
    }
    else if ($(this).val() == "2") {
        $(".legend").remove();
        $("output.temporal-legend").remove();
        $("input.range-slider").remove();

        map.removeLayer(cases);
        map.removeLayer(cumulative);
        map.removeLayer(last_7d);
        map.removeLayer(last_21d);
        map.removeLayer(cumulative_2015);

        var dataWeek = processData(data_per_week);   
                createPropSymbols(dataWeek.timestamps, data_per_week, 'week');  
                createLegend(dataWeek.min,dataWeek.max);    
                createSliderUI(dataWeek.timestamps, 'week');

        $('div.panel').hide();
    }
    else if ($(this).val() == "3") {
      $("output.temporal-legend").remove();
      $("input.range-slider").remove();

      map.removeLayer(cases);
      map.removeLayer(cumulative);
      map.removeLayer(last_21d);
      map.removeLayer(cumulative_2015);

      map.addLayer(last_7d);

      $('div.panel').show();
      $('div.panel-heading').empty()
      $('div.panel-heading').append('<span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>Nombre de cas confirmés par sous-préfectures durant les 7 derniers jours')

      $(function ()  
            { $(".glyphicon-info-sign").tooltip({placement : 'auto', title: "Cliquez sur les colonnes du tableau pour le réordonner", container: 'body'});  
        }); 
      jPut.users.data = table_7d;

      $('.table').each(function () {
            var $table = $(this);

            var $exportCSV = $('<span class="glyphicon glyphicon-save" aria-hidden="true">');
            $exportCSV.appendTo('div.panel-heading');

            $(function ()  
            { $(".glyphicon-save").tooltip({placement : 'auto', title: "Cliquez pour sauvegarder au format CSV", container: 'body'});  
            });

            $exportCSV.click(function () {
                var csv = $table.table2CSV({
                    header: ['Prefecture', 'Sous-prefecture', '# Cas'],
                    delivery: 'value'
                });
 
        var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        fichier = 'cas_7_derniers_jours_2015_08_27.csv'
        if (navigator.msSaveBlob) { // IE 10+
            navigator.msSaveBlob(blob, fichier);
        } 
        else {
            var link = document.createElement("a");
            if (link.download !== undefined) { // feature detection
                // Browsers that support HTML5 download attribute
                var url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", fichier);
                link.style = "visibility:hidden";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
            });

        });


    }
    else if ($(this).val() == "4") {
        $("output.temporal-legend").remove();
        $("input.range-slider").remove();

        map.removeLayer(cases);
        map.removeLayer(cumulative);
        map.removeLayer(last_7d);
        map.removeLayer(cumulative_2015);
        
        map.addLayer(last_21d);

        $('div.panel').show();
        $('div.panel-heading').empty()
        $('div.panel-heading').append('<span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>Nombre de cas confirmés par sous-préfectures durant les 21 derniers jours')

        $(function ()  
            { $(".glyphicon-info-sign").tooltip({placement : 'auto', title: "Cliquez sur les colonnes du tableau pour le réordonner", container: 'body'});  
        }); 
        jPut.users.data = table_21d;

        $('.table').each(function () {
            var $table = $(this);

            var $exportCSV = $('<span class="glyphicon glyphicon-save" aria-hidden="true">');
            $exportCSV.appendTo('div.panel-heading');

            $(function ()  
            { $(".glyphicon-save").tooltip({placement : 'auto', title: "Cliquez pour sauvegarder au format CSV", container: 'body'});  
            });

            $exportCSV.click(function () {
                var csv = $table.table2CSV({
                    header: ['Prefecture', 'Sous-prefecture', '# Cas'],
                    delivery: 'value'
                });
 
        var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        fichier = 'cas_21_derniers_jours_2015_08_27.csv'
        if (navigator.msSaveBlob) { // IE 10+
            navigator.msSaveBlob(blob, fichier);
        } 
        else {
            var link = document.createElement("a");
            if (link.download !== undefined) { // feature detection
                // Browsers that support HTML5 download attribute
                var url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", fichier);
                link.style = "visibility:hidden";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
            });

        });


    }
    else if ($(this).val() == "5") {
        $("output.temporal-legend").remove();
        $("input.range-slider").remove();

        map.removeLayer(cases);
        map.removeLayer(last_7d);
        map.removeLayer(last_21d);
        map.removeLayer(cumulative);

        map.addLayer(cumulative_2015);

        $('div.panel').show();
        $('div.panel-heading').empty()
        $('div.panel-heading').append('<span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>Nombre de cas confirmés par sous-préfectures en 2015')

        $(function ()  
            { $(".glyphicon-info-sign").tooltip({placement : 'auto', title: "Cliquez sur les colonnes du tableau pour le réordonner", container: 'body'});  
        }); 
        jPut.users.data = table_cumul_2015;

        $('.table').each(function () {
            var $table = $(this);

            var $exportCSV = $('<span class="glyphicon glyphicon-save" aria-hidden="true">');
            $exportCSV.appendTo('div.panel-heading');

            $(function ()  
            { $(".glyphicon-save").tooltip({placement : 'auto', title: "Cliquez pour sauvegarder au format CSV", container: 'body'});  
            });

            $exportCSV.click(function () {
                var csv = $table.table2CSV({
                    header: ['Prefecture', 'Sous-prefecture', '# Cas'],
                    delivery: 'value'
                });
 
        var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });

        fichier = 'cas_cumul_2015_2015_05_10.csv'
        if (navigator.msSaveBlob) { // IE 10+
            navigator.msSaveBlob(blob, fichier);
        } 
        else {
            var link = document.createElement("a");
            if (link.download !== undefined) { // feature detection
                // Browsers that support HTML5 download attribute
                var url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", fichier);
                link.style = "visibility:hidden";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
            });

        });

    }
    // value = "6"
    else {
        $("output.temporal-legend").remove();
        $("input.range-slider").remove();

        map.removeLayer(cases);
        map.removeLayer(last_7d);
        map.removeLayer(last_21d);
        map.removeLayer(cumulative_2015);

        map.addLayer(cumulative);

        $('div.panel').show();
        $('div.panel-heading').empty()
        $('div.panel-heading').append('<span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>Nombre de cas confirmés par sous-préfectures depuis le début')

        $(function ()  
            { $(".glyphicon-info-sign").tooltip({placement : 'auto', title: "Cliquez sur les colonnes du tableau pour le réordonner", container: 'body'});  
        }); 
        jPut.users.data = table_cumul;

        $('.table').each(function () {
            var $table = $(this);

            var $exportCSV = $('<span class="glyphicon glyphicon-save" aria-hidden="true">');
            $exportCSV.appendTo('div.panel-heading');

            $(function ()  
            { $(".glyphicon-save").tooltip({placement : 'auto', title: "Cliquez pour sauvegarder au format CSV", container: 'body'});  
            });

            $exportCSV.click(function () {
                var csv = $table.table2CSV({
                    header: ['Prefecture', 'Sous-prefecture', '# Cas'],
                    delivery: 'value'
                });
 
        var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });

        fichier = 'cas_cumul_2015_2015_08_27.csv'
        if (navigator.msSaveBlob) { // IE 10+
            navigator.msSaveBlob(blob, fichier);
        } 
        else {
            var link = document.createElement("a");
            if (link.download !== undefined) { // feature detection
                // Browsers that support HTML5 download attribute
                var url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", fichier);
                link.style = "visibility:hidden";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
            });

        });

    }; 
})
// ----------------- End drop down -----------------

    var switchOsm = L.control( { position: 'topright' } );
    switchOsm.onAdd = function(map) {
    var buttonSwitch = L.DomUtil.create("button", "bswitch btn btn-default");
    //$(buttonSwitch).text("OpenStreetMap");
    $(buttonSwitch).append( '<span class=" glyphicon glyphicon glyphicon-menu-hamburger" aria-hidden="true"></span>');

      L.DomEvent.addListener(buttonSwitch, 'click', function(e) { 

        if (map.hasLayer(OpenStreetMap_HOT) == true) {
            map.removeLayer(OpenStreetMap_HOT);
            map.addLayer(baseLayers);
            
            prefs.bringToBack();
            sous_pref.bringToBack();
            countries.bringToBack();
            
            $("em").show();
        }

        else{
            map.addLayer(OpenStreetMap_HOT);
            $("em").hide();
            map.removeLayer(baseLayers);
        };
      });
      return buttonSwitch;
    };
    switchOsm.addTo(map); 


    var fullZoom = L.control( { position: 'topright' } );
    fullZoom.onAdd = function(map) {
    var buttonZoom = L.DomUtil.create("button", "bzoom btn btn-default");
    $(buttonZoom).append( '<span class=" glyphicon glyphicon glyphicon-globe" aria-hidden="true"></span>');

      L.DomEvent.addListener(buttonZoom, 'click', function(e) { 
          map.setView([10, -11.3441], 7);
      });
      return buttonZoom;
    };
    fullZoom.addTo(map); 

    var printMap = L.control( { position: 'topright' } );
    printMap.onAdd = function(map) {
    var buttonPrint = L.DomUtil.create("button", "bprint btn btn-default");
    $(buttonPrint).append( '<span class=" glyphicon glyphicon glyphicon-print" aria-hidden="true"></span>');

      L.DomEvent.addListener(buttonPrint, 'click', function(e) { 
          $('.dlmap').hide();
          $('#wheel').show();
          leafletImage(map, doImage);
      });
      return buttonPrint;
    };
    printMap.addTo(map); 

    if (L.Browser.ie) {
      $('button.bprint').hide();
    }


    });


    </script>

      
       <!--  <h1>Bootstrap starter template</h1>
        <p class="lead">Use this document as a way to quickly start any new project.<br> All you get is this text and a mostly barebones HTML document.</p>
      </div> -->

    
    </div>
      
    <script src="code/src/bootstrap-3.3.4-dist/js/bootstrap.min.js"></script>
    

     
    <script>  
$(function ()  
{ $("#miseAjour").popover({title: '<b>Dates de mises à jour</b>', content: "Dernière mise à jour : 28/08/2015<br />Dernier cas confirmé : 27/08/2015 "});   
});  
 
$(function ()  
{ $(".bswitch").tooltip({placement : 'auto', title: 'Alternez entre un fond OpenStreetMap et les sous préfectures', container: 'body'});  
}); 

$(function ()  
{ $(".bzoom").tooltip({placement : 'auto', title: 'Revenir au zoom initial', container: 'body'});  
}); 
$(function ()  
{ $(".bprint").tooltip({placement : 'auto', title: 'Imprimez la carte', container: 'body'});  
}); 
</script>

  </body>
</html>