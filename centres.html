<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Daily report (data, maps and graphs) of the Ebola outbreak in Guinea, Rapport journalier (données, cartes, graphes) de l'épidémie Ebola en Guinée, 2014, 2015, VHF">
    <meta name="author" content="WHO, OMS">
    <title>Guinea - EBOV</title>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61269519-1', 'auto');
      ga('send', 'pageview');

    </script>
    <!-- Bootstrap core CSS -->
    <link href="code/src/bootstrap-3.3.4-dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="code/src/leaflet/leaflet.css"/>
    <link rel="stylesheet" href="code/css/leaflet.label.css" />
    <link href="code/src/nvd3-master/nv.d3.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="code/css/style.css"/>
    <script src="code/src/jquery-2.1.1.min.js"></script>
    
    <script src="code/src/html5slider.js"></script>
    <script>L_PREFER_CANVAS = true;</script>
    <script src="code/src/leaflet/leaflet.js"></script>
    <script src='code/src/leaflet-image.js'></script>
    <script src="code/src/leaflet/leaflet.label.js"></script>
    <script src='code/src/jput-2.js'>></script>
    <script src='code/src/stupidtable.min.js'>></script>
    <script src='code/src/table2CSV.js'>></script>
    <script src='code/src/turf.min.js'></script>
    <script src="code/src/nvd3-master/lib/d3.v3.js"></script>
    <script src="code/src/nvd3-master/nv.d3.min.js"></script>
    <script src='code/data/layers/sous_pref.geojson'></script>
    <script src='code/data/layers/countries.geojson'></script>
    <script src='code/data/layers/prefectures.geojson'></script>
    <script src="code/data/last_21d_daily.geojson" type="text/javascript"></script>
    <script src="code/data/cte.geojson" type="text/javascript"></script>
    <script src='code/data/table_cte_capacite.json'></script>


            
    <script type="text/javascript">
    $(document).ready(function(){
            $("table.capacite").stupidtable();
         jPut.users.data = table_cte_capacite;

        $('table.capacite').each(function () {
            var $table = $(this);

            var $exportCSV = $('<span class="glyphicon glyphicon-save" aria-hidden="true">');
            $exportCSV.appendTo('div.sit_capacite');

            $(function ()  
            { $(".glyphicon-save").tooltip({placement : 'auto', title: "Cliquez pour sauvegarder au format CSV", container: 'body'});  
            });

            $exportCSV.click(function () {
                var csv = $table.table2CSV({
                    header: ['Nom', 'Tenu par', 'Labo', 'Lits suspects', 'Lits probables', 'Lits confirmes', 'Total lits'],
                    delivery: 'value'
                });
 
        var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        fichier = 'capacité_centres_ebola_2015_11_30.csv'
        if (navigator.msSaveBlob) { // IE 10+
            navigator.msSaveBlob(blob, fichier);
        } 
        else {
            var link = document.createElement("a");
            if (link.download !== undefined) { // feature detection
                // Browsers that support HTML5 download attribute
                var url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", fichier);
                link.style = "visibility:hidden";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
            });

        });

        $('table.patients').each(function () {
            var $table = $(this);

            var $exportCSV = $('<span class="glyphicon glyphicon-save" aria-hidden="true">');
            $exportCSV.appendTo('div.sit_patients');

            $(function ()  
            { $(".glyphicon-save").tooltip({placement : 'auto', title: "Cliquez pour sauvegarder au format CSV", container: 'body'});  
            });

            $exportCSV.click(function () {
                var csv = $table.table2CSV({
                    header: ['' ,'CTE Conakry', 'CTE Coyah', 'CTE Macenta', 'CTE N’Zerekore', 'CTE Kindia', 'CTE Boke', 'CTE Forecariah', 'CDT Siguiri', 'Total'],
                    delivery: 'value'
                });
 
        var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        fichier = 'situation_patients_centres_ebola_2015_11_30.csv'
        if (navigator.msSaveBlob) { // IE 10+
            navigator.msSaveBlob(blob, fichier);
        } 
        else {
            var link = document.createElement("a");
            if (link.download !== undefined) { // feature detection
                // Browsers that support HTML5 download attribute
                var url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", fichier);
                link.style = "visibility:hidden";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
            });

        });

        });
    </script>

  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html"><img src="code/img/cellule_nationale.png" width="53px" height="51px">&nbsp;Guinea - EBOV</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <!-- <li class="active"><a href="#">Home</a></li> -->
            <li><a href="niveau_alerte.html">Niveau d'alerte</a></li>
            <li><a href="reticences.html">Réticences</a></li>
            <li><a href="centres.html">Centres</a></li>
            <li><a href="epi_weeks.html">Epi weeks</a></li>
            <li><a href="stats.html">Stats</a></li>
            <!-- <li><a href="personnel.html">Personnel</a></li> -->
            <li><a href="liens_utiles.html">Liens utiles</a></li>
            <li><a href="sitreps.html">Sitreps</a></li>
            <li><a id="nouv" href="nouveautes.html">Nouveautés</a></li>
            <li><img src="code/img/who_logo.svg" width="150px" height="50px"></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    <div class="epi_content">
        
<h2>Etat des lieux des centres&nbsp;<a href="#" id="miseAjour" class="btn btn-info" rel="popover" data-html="true"><span class="glyphicon glyphicon-time" aria-hidden="true"></span></a></h2>
<div class="panel panel-default">
      <div class="panel-heading sit_patients">Situation des patients  dans les centres fonctionnels à la date du 30/11/2015<a href="#" onClick ="doExport({type:"json"});"></a></div>
      <table class="table patients table-striped">
         <thead>
            <tr>
              <th></th>
              
                <th data-sort="int">CTE Conakry</th>
              
                <th data-sort="int">CTE Coyah</th>
              
                <th data-sort="int">CTE Macenta</th>
              
                <th data-sort="int">CTE N’Zerekore</th>
              
                <th data-sort="int">CTE Kindia</th>
              
                <th data-sort="int">CTE Boke</th>
              
                <th data-sort="int">CTE Forecariah</th>
              
                <th data-sort="int">CDT Siguiri</th>
              
                <th data-sort="int">Total</th>
              
            </tr> 
         </thead>
         <tbody>
            <tr>
               <td>Cas confirmés</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
            </tr>
            <tr>
               <td>Cas suspects</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
            </tr>
            <tr>
               <td>Sortis guéris</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
            </tr>
            <tr>
               <td>Décédés</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
            </tr>
            <tr>
               <td>Total hospitalisés</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
                <td>0</td>
               
            </tr>
      </tbody>
      </table>
      </div>
      <br>
      <hr id="centres">
      <h2>Evolution de la fréquentation des centres</h2>
      <div class="alert alert-info aide" role="alert">Cliquez sur les boutons ci-dessous pour choisir les variables à représenter</div>
      <br>
    <div class="btn-group">
      <button type="button" id="centres" class="btn btn-default">Centres</button>
      <button type="button" id="patients" class="btn btn-default">Statuts</button>
    </div>
    <br>
    <br>
    <div id='button'></div>
    <br>
    <br>
    <div class="alert alert-warning" role="alert"></div>
    <br>
        <div id='chart' style="width: 0; height: 0; margin: 0 auto;">
            <svg class="chart_cte"></svg>
        </div>
    <script type="text/javascript">
      $(".btn-default").click(function() {
        $("div.aide").empty();
        $("div.aide").height("0px");
        $("div.aide").width("0px");
        $("div.aide").remove();
        $("div#chart").height(0);
        $("div#chart").width(0);
        if ($(this).attr('id') === 'centres') {
          $( "div#button" ).html('<select class="form-control choix_var"><option value="" disabled selected style="display:none;">Choisir              un centre</option><option value="boke_cdt">CDT Boke</option><option value="kerouane_cdt">CDT Kerouane</option><option value="siguiri_cdt">CDT Siguiri</option><option value="boke_cte">CTE Boke</option><option value="conakry_cte">CTE Conakry</option><option value="coyah_cte">CTE Coyah</option><option value="forecariah_cte">CTE Forecariah</option><option value="gueckedou_cte">CTE Gueckedou</option><option value="kindia_cte">CTE Kindia</option><option value="macenta_cte">CTE Macenta</option><option value="n’zerekore_cte">CTE N’Zerekore</option><option value="conakry_cts">CTS Conakry</option><option value="total_conf">Tous les centres</option></select>')
        }
        else{
          $( "div#button" ).html('<select class=" form-control choix_var"><option value="" disabled selected style="display:none;">               Choisir un statut de patient</option><option value="conf">Confirmés</option><option value="susp">Suspects</option><option value="guer">Sortis guéris</option><option value="mort">Décédés</option><option value="tot">Total hospitalisés</option></select>')
        };
        $( "div.alert-warning").hide("slow");
        $( "svg.chart_cte" ).empty();
        
        type = $(this).attr('id');
        
        $("select").change(function () {

            $("div#chart").height("400px");
            $("div#chart").width("75%");

        var val=this.value;
        centre = $(this).val();
        if (type === 'centres') {
          if (centre === "forecariah_cte") {
            $("div.alert-warning" ).text("Le CTE de Forecariah était un centre de transit (CDT) jusqu'au 08/04/2015");
            $("div.alert-warning" ).show("slow");
          }
          else if (centre === "conakry_cts") {
            $("div.alert-warning").text("Le CTS de Conakry a fermé le 15/07/2015");
            $("div.alert-warning" ).show("slow");
          }
          else if (centre === "kindia_cte") {
            $("div.alert-warning").text("Le CTE de Kindia a ouvert le 05/03/2015");
            $("div.alert-warning" ).show("slow");
          }
          else if (centre === "gueckedou_cte") {
            $("div.alert-warning").text("Le CTE de Guéckédou a fermé le 06/04/2015");
            $("div.alert-warning" ).show("slow");
          }
          else if (centre === "boke_cte") {
            $("div.alert-warning").text("Le CTE de Boké a Ouvert le 06/07/2015");
            $("div.alert-warning" ).show("slow");
          }
          else if (centre === "total_conf") {
            $("div.alert-warning").html("Le CTS de Conakry a fermé le 15/07/2015<br>Le CTE de Kindia a ouvert le 05/03/2015<br>Le CTE de Guéckédou a fermé le 06/04/2015<br>Le CTE de Forecariah était un centre de transit (CDT) jusqu'au 08/04/2015<br>Le CTE de Boké a Ouvert le 06/07/2015<br>Le CTE de Donka (Dixinn) a été transféré à Nongo (Ratoma) le 06/07/2015");
            $("div.alert-warning" ).show("slow");
          }
          else {
            $("div.alert-warning").hide("slow");
          };
        }
        if (type === 'patients') {
          $("div.alert-warning").html("Le CTS de Conakry a fermé le 15/07/2015<br>Le CTE de Kindia a ouvert le 05/03/2015<br>Le CTE de Guéckédou a fermé le 06/04/2015<br>Le CTE de Forecariah était un centre de transit (CDT) jusqu'au 08/04/2015");
          $("div.alert-warning" ).show();
        };
        /*$('h3').html('Situation dans le centre de ' + centre); */

        d3.json('code/data/charts/chart_' + centre + '.json', function(data) {
        nv.addGraph(function() {
        var chart = nv.models.stackedAreaChart()
                      .margin({right: 100})
                      //We can modify the data accessor functions...
                      .x(function(d) { return d[0] })   
                      //...in case your data is formatted differently.
                      .y(function(d) { return d[1] })   
                      //Tooltips which show all data points. Very nice!
                      .useInteractiveGuideline(true)    
                      //Allow user to choose 'Stacked', 'Stream', 'Expanded' mode.
                      .showControls(true)       
                      .clipEdge(true);

        //Format x-axis labels with custom function.
        chart.xAxis
            //.ticks(d3.time.periode, 1)
            .tickFormat(function(d) { 
              return d3.time.format('%d/%m/%y')(new Date(d));
        });

        chart.yAxis
            .tickFormat(d3.format('d'))

        d3.select('#chart svg')
          .datum(data)
          .transition().duration(500)
          .call(chart);

      //Update the chart when window resizes.
      nv.utils.windowResize(function() { chart.update() });
      return chart;

                });      
            });
        });
});
    </script>

<hr id="centres">
<h2>Localisation et capacité des centres</h2>
     <div class='dlmap'>
     <a id="print" href=""></a> | <a href="code/img/legende_cas_confirmes_21_derniers_jours_centres.png" download>Télécharger la légende</a></div>
     <div  id="wheel" >
     <img src="code/img/spinning-wheel.gif"/ width="20px" height="20px">
     Impression en cours...</div>
      <div id="map"></div>
      <br />
      <div class="alert alert-info" role="alert">
      A l'exception de Conakry, la localisation des centres n'est précise qu'à l'échelle de la ville
      </div>
      <br />
      <div class="panel panel-default">
      <div class="panel-heading sit_capacite"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>Capacité des centres Ebola à la date du 30/11/2015<a href="#" onClick ="doExport({type:"json"});"></a></div>
      <table class="table capacite table-striped">
         <thead>
            <tr>
                <th data-sort="string">Nom</th>
                <th data-sort="string">Géré par</th>
                <th data-sort="string">Labo</th>
                <th data-sort="int">Lits<br />Suspects</th>
                <th data-sort="int">Lits<br />Probables</th>
                <th data-sort="int">Lits<br />Confirmés</th>
                <th data-sort="int">Total<br />lits</th>
            </tr> 
         </thead>
         <tbody jput="users" jput-jsondata='[]'>
            <tr>
               
               <td>{{json.name}}</td>
               <td>{{json.gere}}</td>
               <td>{{json.labo}}</td>
               <td>{{json.suspect}}</td>
               <td>{{json.probable}}</td>
               <td>{{json.confirme}}</td>
               <td>{{json.total}}</td>
               
            </tr>
      </tbody>
      </table>
      </div>
      <br />
      <div class="panel panel-default"><span id="tot1">Total</span><span id="tot2">6</span><span id="tot3">87</span><span id="tot4">44</span><span  id="tot5">182</span><span id="tot6">313</span></span></div>
      <br />
      <div class="well">Télécharger les données géographiques aux formats <a href="code/files/cte_2015_11_30.kml" download>KML</a> ou <a href="code/files/cte_2015_11_30.geojson" download>GeoJSON</a></div>
</div>
    <script>
 $(document).ready(function() {
         var legend;
         var map = L.map('map', { 
                center: [10, -11.3441], 
                zoom: 7,    
                minZoom: 6  
            });

         function doImage(err, canvas) {
                var img = document.createElement('img');
                var dimensions = map.getSize();
                img.width = dimensions.x;
                img.height = dimensions.y;
                img.src = canvas.toDataURL("image/png");

                var suffixe_file = $("select").val()[0];
                var suffix;
                auj = new Date();
                auj.setDate(auj.getDate() - 1);
                auj = auj.getFullYear() + '_' + parseInt(auj.getMonth() + 1) + '_' + auj.getDate(); 
                if (suffixe_file === "1") {
                    suffix = 'centres_ebola_guinee_' + auj;
                }
                else if (suffixe_file === "2") {
                    suffix = 'cte_guinee_' + auj;
                }
                else if (suffixe_file === "3") {
                    suffix = 'cdt_guinee_' + auj;
                }
                else if (suffixe_file === "4") {
                    suffix = 'cts_guinee_' + auj;
                }
                else{
                    suffix = 'labos_guinee_' + auj;
                };
                
                $("a#print").attr("download", suffix + '.png')
                $("a#print").attr("href", img.src)

                $('#wheel').hide();
                $("a#print").html("Télécharger la carte");
                $('.dlmap').fadeIn("slow");
            }

         var OpenStreetMap_HOT = L.tileLayer('http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Tiles courtesy of <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a>'
});

        var sous_pref = L.geoJson(sp, {
            style: function (feature) {
                return {fillColor: "#ffffbf",
                        color: "#d8b365",
                        weight: 0.8,
                        opacity: 0.8,
                        fillOpacity: .7};
            },
            onEachFeature: function (feature, layer) {
                layer.bindPopup(feature.properties.name, {autoPan: false});
            }
        });

        var countries = L.geoJson(countr, {
            style: function (feature) {
                return {fillColor: "white",
                        color: "black",
                        weight: 1,
                        opacity: 0.8,
                        fillOpacity: 0.8};
            }
        });

        var prefs = L.geoJson(prfs, {
            style: function (feature) {
                return {color: "#8A4117",
                        weight: 1,
                        opacity: 0.8};
            }
        });

        var baseLayers = L.layerGroup([countries, sous_pref, prefs]).addTo(map);
        
        var labelmal= new L.Label();
        labelmal.setContent("<em>MALI</em>");
        labelmal.setLatLng([11.5,-7.55]);
        map.showLabel(labelmal);
        
        var labelciv = new L.Label();
        labelciv.setContent("<em>CÔTE D'IVOIRE</em>");
        labelciv.setLatLng([9.5,-7.55]);
        map.showLabel(labelciv);

        var labelsle = new L.Label();
        labelsle.setContent('<em> SIERRA</br>LEONE</em>');
        labelsle.setLatLng([8.6,-12.2]);
        map.showLabel(labelsle);

        var labellib = new L.Label();
        labellib.setContent('<em>LIBERIA</em>');
        labellib.setLatLng([ 6.8,  -10.5]);
        map.showLabel(labellib);

        var labelgb = new L.Label();
        labelgb.setContent('<em>GUINEE</br>BISSAU</em>');
        labelgb.setLatLng([12.2, -15.2]);
        map.showLabel(labelgb);

        var labelsen = new L.Label();
        labelsen.setContent('<em>SENEGAL</em>');
        labelsen.setLatLng([14.5, -15]);
        map.showLabel(labelsen);


        var last_21d = L.geoJson(data_21d, {  
            onEachFeature: function (feature, layer) {
                popupContent = "<b>" + feature.properties.name + " </b><br>" +
                               "<b>" + String(feature.properties.total) +
                               "</b> cas";
                // Calculations for radius in function of field 'total'
                var scaleFactor = 12,
                area = feature.properties.total * scaleFactor;
                radius =  Math.sqrt(area/Math.PI)*2
                layer.setRadius(radius);
                layer.bindPopup(popupContent, { offset: new L.Point(0,-radius) }); 
                layer.on({
                    mouseover: function(e) {
                        this.openPopup();
                        this.setStyle({color: 'yellow', weight: 2});
                    },
                    mouseout: function(e) {
                        this.closePopup();
                        this.setStyle({color: '#537898', weight: 1});     
                    }
                });
            },
            pointToLayer: function(feature, latlng) {   
                // Calculations for radius. Same as bellow
                var scaleFactor = 12,
                area = feature.properties.total * scaleFactor;
                return L.circleMarker(latlng, {     
                    radius: Math.sqrt(area/Math.PI)*2,
                    /*fillColor: feature.properties.color, */
                    fillColor: "red", 
                    color: '#537898',   
                    weight: 1,  
                    fillOpacity: 0.6  
                });
            }
        });

        function highlightFeature(e) {
            var layer = e.target;


            info.update(layer.feature.properties);
        }

        function resetHighlight(e) {
            ctes.resetStyle(e.target);
            info.update();
        }

        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                /*click: zoomToFeature*/
            });
        }
        var myIcon = L.icon({
            iconUrl: 'code/src/leaflet/images/health.png',
            iconSize: [16, 16]
        });
        var ctes = L.geoJson(cte, {  
            onEachFeature: onEachFeature,
            pointToLayer: function(feature, latlng) {

               return L.marker(latlng, {icon: myIcon});
            }
        }).addTo(map);


        var info = L.control({position: 'bottomleft'});

            info.onAdd = function (map) {
                this._div = L.DomUtil.create('div', 'info cte'); // create a div with a class "info"
                this.update();
                return this._div;
            };

            // method that we will use to update the control based on feature properties passed
            info.update = function (props) {
  
                this._div.innerHTML = '<h4>Capacité des centres Ebola</h4>' + (props ?
                    '<b>' + props.name + '</b><br />' +
                    'Géré par : ' + props.gere + '<br />' +
                    'Laboratoire : ' + props.labo + '<br />' +
                    'Lits confirmés : ' + props.confirme + '<br />' +
                    'Lits suspects : ' + props.suspect + '<br />' +
                    'Lits probables : ' + props.probable + '<br />' +
                    'Total lits : ' + props.total + '<br />'
                    : 'Survolez un centre');
            };

            info.addTo(map);

    function calcPropRadius(attributeValue) {
                
            var scaleFactor = 12,  // value dependent upon particular data set
                area = attributeValue * scaleFactor; 

            return Math.sqrt(area/Math.PI)*2;  
                
        } // end calcPropRadius

    function createLegend(min, max) {     
        if (min < 10) { 
            min = 1; 
    }
    function roundNumber(inNumber) {

        return (Math.round(inNumber/10) * 10);  
    }

    legend = L.control( { position: 'bottomright' } );

    legend.onAdd = function(map) {

        var legendContainer = L.DomUtil.create("div", "legend"),  
            symbolsContainer = L.DomUtil.create("div", "symbolsContainer"),
            classes = [1, 10, 40], 

            diameter,
            diameters = [];

        L.DomEvent.addListener(legendContainer, 'mousedown', function(e) { L.DomEvent.stopPropagation(e); });  

        $(legendContainer).append("<h2 id='legendTitle'>Nombre de cas<br/>confirmés durant les<br/>21 derniers jours</h2>");
        
        for (var i = 0; i < classes.length; i++) {  

            legendCircle = L.DomUtil.create("div", "legendCircle");  
            diameter = calcPropRadius(classes[i])*2; 
            diameters.push(diameter);               
            var lastdiameter;                   
            if (diameters[i-1]){
                lastdiameter = diameters[i-1];
            } else {
                lastdiameter = 0;
            };
            $(legendCircle).attr("style", "width: "+diameter+"px; height: "+diameter+
                "px; margin-left: -"+((diameter+lastdiameter+2)/2)+"px" );                   
            $(legendCircle).append("<span class='legendValue'>"+classes[i]+"<span>");
            $(symbolsContainer).append(legendCircle);   
        };
        $(legendContainer).append(symbolsContainer); 
        return legendContainer; 
    }; 
}
// end createLegend()
createLegend(last_21d.min, last_21d.max); 
        
var dropdmenu = L.control({position: 'topright'});
dropdmenu.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info dropdmenu');
    div.innerHTML = '<select class="form-control CTE"><option value="1">Tous les centres</option><option value="2">Centre de Traitement Ebola (CTE)</option><option value="3">Centre de Transit (CDT)</option><option value="4">Centre de Traitement des Soignants (CTS)</option><option value="5">Centres avec laboratoire</option></select>';
    div.firstChild.onmousedown = div.firstChild.ondblclick = L.DomEvent.stopPropagation;
    return div;
};

dropdmenu.addTo(map);
var passage_scope;
$("select").change(
 function () {
  var val = this.value;
    if ($(this).val() === "1") {
        map.addLayer(ctes);
        if (map.hasLayer(passage_scope)) {
            map.removeLayer(passage_scope);
        }

    }
    else if ($(this).val() === "2") {
        map.removeLayer(ctes);
        if (map.hasLayer(passage_scope)) {
            map.removeLayer(passage_scope);
        }
        
        var key = "type";
        var value = "CTE";

        var filtered = turf.filter(cte, key, value);
        var l_filtered = L.geoJson(filtered, {  
            onEachFeature: onEachFeature,
            pointToLayer: function(feature, latlng) {
               return L.marker(latlng, {icon: myIcon});
            }
        }).addTo(map);
        passage_scope = l_filtered;


    }
    else if ($(this).val() === "3") {
        map.removeLayer(ctes);
        if (map.hasLayer(passage_scope)) {
            map.removeLayer(passage_scope);
        }
        
        var key = "type";
        var value = "CDT";

        var filtered = turf.filter(cte, key, value);
        var l_filtered = L.geoJson(filtered, {  
            onEachFeature: onEachFeature,
            pointToLayer: function(feature, latlng) {
               return L.marker(latlng, {icon: myIcon});
            }
        }).addTo(map);
        passage_scope = l_filtered;
    }
    else if ($(this).val() === "4") {
        map.removeLayer(ctes);
        if (map.hasLayer(passage_scope)) {
            map.removeLayer(passage_scope);
        }

        var key = "type";
        var value = "CTS";

        var filtered = turf.filter(cte, key, value);
        var l_filtered = L.geoJson(filtered, {  
            onEachFeature: onEachFeature,
            pointToLayer: function(feature, latlng) {
               return L.marker(latlng, {icon: myIcon});
            }
        }).addTo(map);
        passage_scope = l_filtered;
    }
    // value = "5"
    else {
        map.removeLayer(ctes);
        if (map.hasLayer(passage_scope)) {
            map.removeLayer(passage_scope);
        }

        var key = "labo";
        var value = "Oui";

        var filtered = turf.filter(cte, key, value);
        var l_filtered = L.geoJson(filtered, {  
            onEachFeature: onEachFeature,
            pointToLayer: function(feature, latlng) {
               return L.marker(latlng, {icon: myIcon});
            }
        }).addTo(map);
        passage_scope = l_filtered;
        

    }; 
})
// ----------------- End drop down -----------------

    var switchOsm = L.control( { position: 'topright' } );
    switchOsm.onAdd = function(map) {
    var buttonSwitch = L.DomUtil.create("button", "bswitch btn btn-default");
    //$(buttonSwitch).text("OpenStreetMap");
    $(buttonSwitch).append( '<span class=" glyphicon glyphicon glyphicon-menu-hamburger" aria-hidden="true"></span>');

      L.DomEvent.addListener(buttonSwitch, 'click', function(e) { 

        if (map.hasLayer(OpenStreetMap_HOT) == true) {
            map.removeLayer(OpenStreetMap_HOT);
            map.addLayer(baseLayers);
            
            prefs.bringToBack();
            sous_pref.bringToBack();
            countries.bringToBack();
            
            $("em").show();
        }

        else{
            map.addLayer(OpenStreetMap_HOT);
            $("em").hide();
            map.removeLayer(baseLayers);
        };
      });
      return buttonSwitch;
    };
    switchOsm.addTo(map); 


    var fullZoom = L.control( { position: 'topright' } );
    fullZoom.onAdd = function(map) {
    var buttonZoom = L.DomUtil.create("button", "bzoom btn btn-default");
    $(buttonZoom).append( '<span class=" glyphicon glyphicon glyphicon-globe" aria-hidden="true"></span>');

      L.DomEvent.addListener(buttonZoom, 'click', function(e) { 
          map.setView([10, -11.3441], 7);
      });
      return buttonZoom;
    };
    fullZoom.addTo(map); 


    var switch21d = L.control( { position: 'topright' } );
            switch21d.onAdd = function(map) {
            var buttonSwitch21d = L.DomUtil.create("button", "bswitch21dCTE btn btn-default");
            $(buttonSwitch21d).append( '<span class=" glyphicon glyphicon glyphicon-eye-open" aria-hidden="true"></span>');
            /*$(buttonSwitch2).text("Cumulative Data");*/

            L.DomEvent.addListener(buttonSwitch21d, 'click', function(e) { 

            var $this = $(this);
            if ($this.html() == '<span class=" glyphicon glyphicon glyphicon-eye-open" aria-hidden="true"></span>') {
                 $this.html( '<span class=" glyphicon glyphicon glyphicon-eye-close" aria-hidden="true"></span>');
                 map.addLayer(last_21d);
                 legend.addTo(map)
            } 
            else {
                 $this.html( '<span class=" glyphicon glyphicon glyphicon-eye-open" aria-hidden="true"></span>');
                 
                 map.removeLayer(last_21d);
                 legend.removeFrom(map);
            };
            });

            return buttonSwitch21d;
                   };
            switch21d.addTo(map);

        var printMap = L.control( { position: 'topright' } );
        printMap.onAdd = function(map) {
        var buttonPrint = L.DomUtil.create("button", "bprint_ct btn btn-default");
        $(buttonPrint).append( '<span class=" glyphicon glyphicon glyphicon-print" aria-hidden="true"></span>');

          L.DomEvent.addListener(buttonPrint, 'click', function(e) { 
              $('.dlmap').hide();
              $('#wheel').show();
              leafletImage(map, doImage);
          });
          
          return buttonPrint;
        };
        printMap.addTo(map); 

        if (L.Browser.ie) {
          $('button.bprint_ct').hide();
        }  

    });
    </script>

    </div>
      
    <script src="code/src/bootstrap-3.3.4-dist/js/bootstrap.min.js"></script>
    

         
<script>  
$(function ()  
{ $("#miseAjour").popover({title: '<b>Dates de mises à jour</b>', content: "Dernière mise à jour : 1/12/2015<br />Dernier cas confirmé : 27/10/2015 "});   
});  
 
$(function ()  
{ $(".bswitch").tooltip({placement : 'auto', title: 'Alternez entre un fond OpenStreetMap et les sous préfectures', container: 'body'});  
}); 

$(function ()  
{ $(".bzoom").tooltip({placement : 'auto', title: 'Revenir au zoom initial', container: 'body'});  
}); 

$(function ()  
{ $(".bswitch21dCTE").tooltip({placement : 'auto', title: 'Affichez ou cachez le nombre de cas par sous préfectures durant les 21 derniers jours', container: 'body'});  
});
$(function ()  
    { $(".glyphicon-info-sign").tooltip({placement : 'auto', title: "Cliquez sur les colonnes du tableau pour le réordonner", container: 'body'});  
}); 
$(function ()  
{ $(".bprint_ct").tooltip({placement : 'auto', title: 'Imprimez la carte', container: 'body'});  
});
</script>

  </body>
</html>